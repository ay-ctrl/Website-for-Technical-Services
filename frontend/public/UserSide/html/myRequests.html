<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telefon Tamiri</title>
    <meta name="description"
        content="Yerinde ve garantili cep telefonu tamiri hizmeti! Uygun fiyatlarla ekran, batarya deÄŸiÅŸimi ve teknik servis Ã§Ã¶zÃ¼mleri. HÄ±zlÄ± ve gÃ¼venilir tamir iÃ§in hemen ulaÅŸÄ±n.">
    <link rel="canonical" href="https://telefon-tamiri-seng209-211.com.tr/">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <meta property="og:title" content="Uygun Fiyatlarla AkÄ±llÄ± Cihaz Tamir Hizmeti Sizlerle">
    <meta property="og:description" content=" HÄ±zlÄ± ve gÃ¼venilir tamir iÃ§in hemen ulaÅŸÄ±n.">
    <meta property="og:url" content="https://telefon-tamiri-seng209-211.com.tr/">
    <link rel="stylesheet" href="../css/myRequests.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <!-- URL LÄ°NKÄ°NÄ° DAHA GÃœZEL BÄ°R ÅEY YAP PLS-->
</head>

<body class="main page-loading animation">
        <!-- Header -->
        <header>
            <div class="logo">
                <a href="dashboard.html">
                    <img src="/public/images/ayda-logo.png" alt="Telefon Tamiri"
                        width="150">
                </a>
            </div>
    
            <!-- Navigation -->
            <nav>
                <ul>
                    <li><a href="myRequests.html">Taleplerim</a></li>
                    <li><a href="products.html">Aksesuar ve Ek ÃœrÃ¼nler</a></li>
                    <li><a href="hakkÄ±mÄ±zda.html">HakkÄ±mÄ±zda</a></li>
                    <li><a href="SSS.html">SSS</a></li>
                    <li class="dropdown">
                        <button class="dropdown-button">Admin KullanÄ±cÄ±sÄ±</button>
                        <div class="dropdown-content">
                            <a href="#">Ã–demeler</a>
                            <a href="#">Ã‡alÄ±ÅŸanlar</a>
                            <a href="changePassword.html">Åifre deÄŸiÅŸtir</a>
                            <a href="../../../index.html">Ã‡Ä±kÄ±ÅŸ Yap</a>
                        </div>
                    </li>
                </ul>
    
            </nav>
    
        </header>
    
    
        <!-- Ana Ä°Ã§erik AlanÄ± -->
        <div class="hakkimizda-container">
            <h2 class="title">TALEPLERÄ°M</h2>
        </div>
    
        <section id="container">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th><b>Talep No</b></th>
                            <th><b>Model</b></th>
                            <th><b>MÃ¼ÅŸteri AdÄ±</b></th>
                            <th><b>Telefon No</b></th>
                            <th><b>Problem</b></th>
                            <th><b>Tarih</b></th>
                            <th><b>Durum</b></th>
                            <th><b>Yedek Cihaz</b></th>
                            <th><b>Ãœcret</b></th>
                            <th><b>DÃœZENLE</b></th>
                            <th><b>SÄ°L</b></th>
                        </tr>
                    </thead>
                    <tbody class="tbody">
                        <!-- bu kÄ±sÄ±m backenden alÄ±nÄ±yor-->
                    </tbody>
                </table>
            </div>
        </section>
    
    
        <div class="pagination" id="pagination">
            <a href="#">1</a>
            <a href="#">2</a>
            <a href="#">3</a>
            <a href="#">4</a>
            <span>...</span>
            <a href="#">11</a>
        </div>
    
        <!-- Footer -->
        <footer>
            <div class="footer-container">
                <!-- Sol SÃ¼tun -->
                <div class="footer-column">
                    <h3>Telefon Tamiri</h3>
                    <ul>
                        <li><a href="myRequests.html">Taleplerim</a></li>
                        <li><a href="products.html">Aksesuar ve Ek ÃœrÃ¼nler</a></li>
                        <li><a href="hakkÄ±mÄ±zda.html">HakkÄ±mÄ±zda</a></li>
                        <li><a href="SSS.html">SSS</a></li>
                    </ul>
                </div>
                <!-- Orta SÃ¼tun -->
                <div class="footer-column">
                    <h3>Ä°letiÅŸim</h3>
                    <p>Adres:Ã‡ankaya/Ankara</p>
                    <p>Email: <a href="mailto:destek@gmail.com">destek@gmail.com</a></p>
                    <p>Telefon: <a href="tel:+905XXXXXXXXX">0 (XXX) XXX XX XX</a></p>
                    <p>Ã‡alÄ±ÅŸma Saatleri: 09:00 - 19:30</p>
                </div>
                <!-- SaÄŸ SÃ¼tun -->
                <div class="footer-column">
                    <h3>Sosyal Medya</h3>
                    <a href="https://www.instagram.com/"><img src="https://cdn-icons-png.flaticon.com/256/717/717392.png"
                            alt="Instagram"></a>
                    <a href="https://x.com/home"><img
                            src="https://logoeps.com/wp-content/uploads/2014/01/23931-twitter-logo-icon-vector-icon-vector-eps.png"
                            alt="Twitter"></a>
                    <a href="https://www.whatsapp.com/"><img
                            src="https://logoeps.com/wp-content/uploads/2014/03/33447-whatsapp-logo-icon-vector-icon-vector-eps.png"
                            alt="WhatsApp"></a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Â© 2024 - TÃ¼m HaklarÄ± SaklÄ±dÄ±r. Telefon Tamiri</p>
            </div>
        </footer>
    
        <!-- MesajlaÅŸma Ikonu -->
        <div class="message-icon">
            <a href="https://dashboard.tawk.to/#/chat" target="_blank">
                <img  src="/public/images/message.png" alt="MesajlaÅŸma Ä°konu">
            </a>
        </div>

    <script>
        let currentPage = 1;
let totalPages = 0;

// Talepleri getirir
async function fetchRequests(page = 1) {
    try {
        const response = await fetch(`http://localhost:3000/get-requests?page=${page}`);
        const data = await response.json();

        currentPage = data.currentPage;
        totalPages = data.totalPages;

        displayRequests(data.requests);
        displayPagination(totalPages, currentPage);
    } catch (err) {
        console.error('Error fetching requests:', err);
    }
}

// Talepleri tabloya ekler
function displayRequests(requests) {
    const tbody = document.querySelector('.tbody');
    tbody.innerHTML = '';  // Mevcut iÃ§eriÄŸi temizle

    requests.forEach(request => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${request.queryNum}</td>
            <td>${request.model}</td>
            <td>${request.name}</td>
            <td>${request.phone}</td>
            <td>${request.sorunlar}</td>
            <td>${new Date(request.createdAt).toLocaleString('tr-TR')}</td>
            <td>${request.state}</td>
            <td>${request.yedekCihaz}</td>
            <td>${request.price}</td>
            <td><a href="talepDÃ¼zenle.html?id=${request._id}"><button>ğŸ“</button></a></td>
            <td><button onclick="deleteRequest('${request._id}')">ğŸ—‘ï¸</button></td>
        `;
        tbody.appendChild(row);
    });
}

// Sayfa numaralarÄ±nÄ± ve Ã¶nceki/sonraki dÃ¼ÄŸmelerini oluÅŸturur
function displayPagination(totalPages, currentPage) {
    const container = document.getElementById('pagination');
    container.innerHTML = '';  // Ã–nceki sayfa numaralarÄ±nÄ± temizle

    // Ã–nceki sayfaya geÃ§iÅŸ
    if (currentPage > 1) {
        const prevPage = document.createElement('a');
        prevPage.textContent = 'Ã–nceki';
        prevPage.href = '#';
        prevPage.addEventListener('click', (e) => {
            e.preventDefault();
            fetchRequests(currentPage - 1);
        });
        container.appendChild(prevPage);
    }

    // Sayfa numaralarÄ±
    for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement('a');
        pageButton.textContent = i;
        pageButton.href = '#';
        pageButton.className = i === currentPage ? 'active' : ''; // Aktif sayfayÄ± vurgula
        pageButton.addEventListener('click', (e) => {
            e.preventDefault();
            fetchRequests(i);
        });
        container.appendChild(pageButton);
    }

    // Sonraki sayfaya geÃ§iÅŸ
    if (currentPage < totalPages) {
        const nextPage = document.createElement('a');
        nextPage.textContent = 'Sonraki';
        nextPage.href = '#';
        nextPage.addEventListener('click', (e) => {
            e.preventDefault();
            fetchRequests(currentPage + 1);
        });
        container.appendChild(nextPage);
    }
}

// Talebi siler
async function deleteRequest(id) {
    const isConfirmed = confirm('Bu talebi silmek istediÄŸinizden emin misiniz?');

    if (isConfirmed) {
        try {
            const response = await fetch(`http://localhost:3000/delete-request/${id}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                console.log('Talep silindi');
                fetchRequests(currentPage); // Mevcut sayfayÄ± yeniden yÃ¼kle
            } else {
                console.error('Silme baÅŸarÄ±sÄ±z');
            }
        } catch (err) {
            console.error('Hata:', err);
        }
    } else {
        console.log('Silme iÅŸlemi iptal edildi.');
    }
}

// Sayfa yÃ¼klendiÄŸinde talepleri yÃ¼kle
document.addEventListener('DOMContentLoaded', () => fetchRequests());


        /*document.querySelector('.search-btn').addEventListener('click', function() {
        const searchTerm = document.querySelector('#search').value.trim();
        fetchRequests(1, searchTerm); // Arama terimi ile talepleri yeniden yÃ¼kle
        });*/

    </script>
</body>

</html>